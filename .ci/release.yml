version: 0.2
phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      # TODO sign commits and tags
      - git clone --branch $PIPELINE_BRANCH https://$GITHUB_ACCESS_TOKEN@github.com/micov6/go-argparse.git repo
      - git config --global user.name $GIT_USER
      - git config --global user.email $GIT_EMAIL
      - git config user.name
      - git config user.email
      - ./scripts/install_github_cli.sh
      - echo $GITHUB_ACCESS_TOKEN > github_token
      - gh auth login -h github.com -p https --with-token < github_token
      - cd repo
  build:
    commands:
      - ./scripts/release $MASTER_BRANCH $PIPELINE_BRANCH

